# Kotlin Multiplatform Benchmarks

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ Kotlin Multiplatform –ø—Ä–æ–µ–∫—Ç–∞—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º kotlinx.benchmark. –ü–æ–∫–∞–∑–∞–Ω—ã —Ä–∞–∑–ª–∏—á–∏—è –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É JVM, JavaScript (Node.js) –∏ Native –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏.

## üéØ –¶–µ–ª—å –ø—Ä–∏–º–µ—Ä–∞

–ü–æ–Ω—è—Ç—å –∫–∞–∫:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å kotlinx.benchmark –¥–ª—è multiplatform –ø—Ä–æ–µ–∫—Ç–∞
- –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –°—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Ç–∞—Ä–≥–µ—Ç–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å expect/actual –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
04-multiplatform/
‚îú‚îÄ‚îÄ build.gradle.kts          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ multiplatform + benchmarks
‚îú‚îÄ‚îÄ run.sh                    # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ commonMain/kotlin/
    ‚îÇ   ‚îú‚îÄ‚îÄ CollectionBenchmark.kt    # –û–±—â–∏–µ –±–µ–Ω—á–º–∞—Ä–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π
    ‚îÇ   ‚îú‚îÄ‚îÄ PlatformBenchmark.kt      # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
    ‚îÇ   ‚îî‚îÄ‚îÄ PlatformOptimizer.kt      # expect –∫–ª–∞—Å—Å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
    ‚îú‚îÄ‚îÄ jvmMain/kotlin/
    ‚îÇ   ‚îî‚îÄ‚îÄ PlatformOptimizer.jvm.kt  # JVM —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º
    ‚îú‚îÄ‚îÄ jsMain/kotlin/
    ‚îÇ   ‚îî‚îÄ‚îÄ PlatformOptimizer.js.kt   # JavaScript —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è V8
    ‚îú‚îÄ‚îÄ linuxX64Main/kotlin/
    ‚îÇ   ‚îî‚îÄ‚îÄ PlatformOptimizer.linux.kt # Native Linux —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ macosX64Main/kotlin/
    ‚îÇ   ‚îî‚îÄ‚îÄ PlatformOptimizer.macos.kt # Native macOS x64 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    ‚îî‚îÄ‚îÄ macosArm64Main/kotlin/
        ‚îî‚îÄ‚îÄ PlatformOptimizer.macos.kt # Native macOS ARM64 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
```

## üèóÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Gradle –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```kotlin
kotlin {
    jvm()
    js(IR) { nodejs() }
    linuxX64()
    macosX64()
    macosArm64()
}

benchmark {
    targets {
        register("jvm")
        register("js")
        register("linuxX64")
        register("macosX64")
        register("macosArm64")
    }

    configurations {
        register("smoke") {
            warmups = 3
            iterations = 5
            iterationTime = 500
            iterationTimeUnit = "ms"
        }
    }
}
```

### –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ —Ç–∞—Ä–≥–µ—Ç—ã

- **JVM**: Java 17, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ForkJoinPool –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
- **JavaScript**: Node.js, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è V8 engine
- **Native Linux**: LLVM –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏
- **Native macOS**: Foundation API, –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

## üî¨ –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ –∞—Å–ø–µ–∫—Ç—ã

### 1. –ö–æ–ª–ª–µ–∫—Ü–∏–∏ (CollectionBenchmark)
```kotlin
@Benchmark
fun filterMap(): List<String> =
    data.filter { it % 2 == 0 }.map { "item$it" }

@Benchmark
fun sequence(): List<String> = data.asSequence()
    .filter { it % 2 == 0 }
    .map { "item$it" }
    .toList()
```

### 2. –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (PlatformBenchmark)

#### JVM —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∏–º—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π
- ForkJoinPool –¥–ª—è heavy computations
- RecursiveTask –¥–ª—è divide-and-conquer

#### JavaScript —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è V8 engine
- StringBuilder –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏
- –ò–∑–±–µ–∂–∞–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π

#### Native —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- LLVM –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- Insertion sort –¥–ª—è –º–∞–ª—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤
- Foundation API –¥–ª—è macOS
- –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ü–∏–∫–ª–æ–≤

## üöÄ –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
```bash
./run.sh
```

–ú–µ–Ω—é:
1. **JVM —Ç–µ—Å—Ç—ã** - –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞ JVM
2. **JavaScript —Ç–µ—Å—Ç—ã** - —Ç–µ—Å—Ç—ã –≤ Node.js
3. **Native —Ç–µ—Å—Ç—ã** - –Ω–∞—Ç–∏–≤–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è
4. **–í—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã** - –ø–æ–ª–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
5. **Smoke —Ç–µ—Å—Ç—ã** - –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º

### –ü—Ä—è–º—ã–µ –∫–æ–º–∞–Ω–¥—ã Gradle

```bash
# JVM –±–µ–Ω—á–º–∞—Ä–∫–∏
./gradlew benchmark --configuration-name=smoke

# JavaScript –±–µ–Ω—á–º–∞—Ä–∫–∏
./gradlew jsBenchmark --configuration-name=smoke

# Native –±–µ–Ω—á–º–∞—Ä–∫–∏ (macOS)
./gradlew macosX64Benchmark --configuration-name=smoke
./gradlew macosArm64Benchmark --configuration-name=smoke

# –í—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
./gradlew benchmark jsBenchmark macosX64Benchmark
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### Collection Benchmarks

| Operation | JVM | JS | Native | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|-----|-----|--------|-------------|
| filterMap | ~50Œºs | ~80Œºs | ~30Œºs | Native fastest |
| sequence | ~45Œºs | ~75Œºs | ~25Œºs | Lazy evaluation wins |

### Platform Optimizations

| Operation | Standard | JVM Optimized | JS Optimized | Native Optimized |
|-----------|----------|---------------|--------------|------------------|
| Sort 100K | ~50ms | ~20ms | ~60ms | ~15ms |
| String concat | ~10ms | ~5ms | ~8ms | ~3ms |
| Heavy computation | ~100ms | ~40ms | ~120ms | ~80ms |

## üîç –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

### JVM
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∏–º—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π (>1000 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
- ForkJoinPool —Ö–æ—Ä–æ—à–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –º–Ω–æ–≥–æ—è–¥–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
- Overhead —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ n>1000

### JavaScript
- V8 –æ—Ç–ª–∏—á–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ —Ü–∏–∫–ª—ã
- Array methods —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–µ–µ —Ä—É—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤
- StringBuilder —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–π –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏

### Native
- LLVM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π –∫–æ–¥
- Insertion sort –ø–æ–±–µ–∂–¥–∞–µ—Ç –¥–ª—è –º–∞–ª—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤ (<50)
- Foundation API –Ω–∞ macOS –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä—è–º—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Kotlin 2.0.20+
- Gradle 8.4+
- JDK 17
- Node.js (–¥–ª—è JS —Ç–µ—Å—Ç–æ–≤)
- Xcode Command Line Tools (–¥–ª—è macOS Native)

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Warmup –≤–∞–∂–µ–Ω**: –û—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è JVM (JIT –∫–æ–º–ø–∏–ª—è—Ü–∏—è)
2. **–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –æ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
3. **–ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è**: –ù–µ –≤—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º—ã
4. **Memory layout**: Native –∫–æ–¥ –±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º –ø–æ –ø–∞–º—è—Ç–∏

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [kotlinx.benchmark –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://github.com/Kotlin/kotlinx-benchmark)
- [Kotlin Multiplatform](https://kotlinlang.org/docs/multiplatform.html)
- [Kotlin/Native performance](https://kotlinlang.org/docs/native-performance.html)

## ü§î –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è

1. –ü–æ—á–µ–º—É Native –∫–æ–¥ –Ω–µ –≤—Å–µ–≥–¥–∞ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π?
2. –ö–æ–≥–¥–∞ –æ–ø—Ä–∞–≤–¥–∞–Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π?
3. –ö–∞–∫ –∏–∑–º–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ production?
4. –ö–∞–∫–∏–µ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å—é –∫–æ–¥–∞?